# Schema

![Screenshot 2024-11-16 at 5.35.07 PM.png](Schema%201da02d8481be8161aca7c02a5975e094/Screenshot_2024-11-16_at_5.35.07_PM.png)

1. Users table
2. Content Table
3. Shareable Link Table
4. Tags

## Hints

- User schema

  ```jsx
  const userSchema = new mongoose.Schema({
    username: { type: String, required: true, unique: true },
    password: { type: String, required: true },
  });
  ```

- Tags Schema

  ```jsx
  const mongoose = require("mongoose");

  const tagSchema = new mongoose.Schema({
    title: { type: String, required: true, unique: true },
  });

  const Tag = mongoose.model("Tag", tagSchema);
  module.exports = Tag;
  ```

- Content Schema

  ```jsx
  const contentTypes = ["image", "video", "article", "audio"]; // Extend as needed

  const contentSchema = new Schema({
    link: { type: String, required: true },
    type: { type: String, enum: contentTypes, required: true },
    title: { type: String, required: true },
    tags: [{ type: Types.ObjectId, ref: "Tag" }],
    userId: { type: Types.ObjectId, ref: "User", required: true },
  });
  ```

- Link Schema

  ```jsx
  const linkSchema = new mongoose.Schema({
    hash: { type: String, required: true },
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "User",
      required: true,
    },
  });
  ```

- Populating relationships

  ```jsx
  const content = await Content.find().populate({
    path: "userId",
    select: "username password",
  });
  ```
  
- Relationships in mongoose
  **Mongoose does not enforce strict relationships** the way relational databases (like MySQL or PostgreSQL) do. In a relational database, foreign keys and constraints would enforce that a reference to another table must exist, and an error would be thrown if you tried to insert a reference to a non-existent record. However, Mongoose and MongoDB do not impose such constraints by default.
- How to Enforce Validation:

1. Using validate

   ```jsx
   const contentSchema = new mongoose.Schema({
     title: String,
     link: String,
     userId: {
       type: mongoose.Schema.Types.ObjectId,
       ref: "User",
       required: true,
       validate: async function (value) {
         const user = await User.findById(value);
         if (!user) {
           throw new Error("User does not exist");
         }
       },
     },
   });
   ```

   1. Using pre-save hook

   ```jsx
   contentSchema.pre("save", async function (next) {
     const user = await User.findById(this.userId);
     if (!user) {
       throw new Error("User does not exist");
     }
     next();
   });
   ```
